---
version: "0.1"
globalTimeout: 30
testSuiteTimeout: 15
testSuiteStep: 5

runson: linux
autosplit: true
concurrency: 10

runtime:
  language: node
  version: "20"

env:
  TEST_ENV: ${TEST_ENV}
  TEST_SUITE: "@smoke"
  TEST_MODE: "remote"
  LT_PROFILE: ${LT_PROFILE}
  LT_RUN_PROFILE: "smoke"
  LT_BUILD_ID: ${LT_BUILD_ID}
  LT_USERNAME: ${LT_USERNAME}
  LT_ACCESS_KEY: ${LT_ACCESS_KEY}
  AUTH_EMAIL: ${AUTH_EMAIL}
  AUTH_PASSWORD: ${AUTH_PASSWORD}
  HE_BUILD_ID: ${HE_BUILD_ID}

cacheKey: '{{ checksum "package-lock.json" }}'
cacheDirectories:
  - node_modules
  - /home/user/.cache/ms-playwright

globalPre:
  commands:
    - npm ci

pre:
  - npm ci

testDiscovery:
  type: raw
  mode: remote
  command: node scripts/discover-tests.js --env $TEST_ENV --grep "@smoke"

testRunnerCommand: node scripts/run-tests.js --env $TEST_ENV --mode remote --run-profile smoke --grep "@smoke" --retries 1 -- tests/$test

post:
  - echo "Test suite complete"

uploadArtefacts:
  - name: playwright-report
    path:
      - playwright-report/
  - name: allure-results
    path:
      - allure-results/
