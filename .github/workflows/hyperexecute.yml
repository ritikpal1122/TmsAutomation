name: HyperExecute Tests

on:
  workflow_dispatch:
    inputs:
      test_suite:
        description: 'Test suite to run'
        required: true
        default: '@smoke'
        type: choice
        options:
          - '@smoke'
          - '@regression'
      environment:
        description: 'Target environment'
        required: true
        default: 'stage'
        type: choice
        options:
          - stage
          - eu-stage
          - prod
          - eu-prod
      concurrency:
        description: 'HyperExecute concurrency'
        required: false
        default: '5'
        type: string

jobs:
  hyperexecute:
    name: HE ${{ inputs.environment }} â€” ${{ inputs.test_suite }}
    runs-on: ubuntu-latest
    timeout-minutes: 60

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Download HyperExecute CLI
        run: |
          curl -sL https://downloads.lambdatest.com/hyperexecute/linux/hyperexecute -o hyperexecute
          chmod +x hyperexecute

      - name: Run HyperExecute
        run: |
          ./hyperexecute \
            --user ${{ secrets.LT_USERNAME }} \
            --key ${{ secrets.LT_ACCESS_KEY }} \
            --config hyperexecute.yaml \
            --vars "TEST_ENV=${{ inputs.environment }}" \
            --vars "TEST_SUITE=${{ inputs.test_suite }}" \
            --vars "HE_BUILD_ID=${{ github.run_number }}" \
            --vars "REPORT_LAB_URL=${{ secrets.REPORT_LAB_URL }}" \
            --vars "SLACK_BOT_TOKEN=${{ secrets.SLACK_BOT_TOKEN }}" \
            --vars "SLACK_CHANNEL=${{ secrets.SLACK_CHANNEL }}" \
            --vars "SLACK_MENTIONS=${{ secrets.SLACK_MENTIONS }}"
        env:
          LT_USERNAME: ${{ secrets.LT_USERNAME }}
          LT_ACCESS_KEY: ${{ secrets.LT_ACCESS_KEY }}
          AUTH_EMAIL: ${{ secrets.AUTH_EMAIL }}
          AUTH_PASSWORD: ${{ secrets.AUTH_PASSWORD }}
          AUTH_TOKEN: ${{ secrets.AUTH_TOKEN }}
