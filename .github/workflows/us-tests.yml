name: US E2E Tests

on:
  workflow_dispatch:
    inputs:
      test_suite:
        description: 'Test suite to run'
        required: true
        default: '@smoke'
        type: choice
        options:
          - '@smoke'
          - '@regression'
      environment:
        description: 'Target environment'
        required: true
        default: 'stage'
        type: choice
        options:
          - stage
          - prod

  schedule:
    # Smoke: daily at 8:00 AM UTC
    - cron: '0 8 * * *'
    # Regression: weekly Sunday at midnight UTC
    - cron: '0 0 * * 0'

jobs:
  e2e:
    uses: ./.github/workflows/reusable-e2e.yml
    with:
      region: 'US'
      test_suite: ${{ github.event.inputs.test_suite || (github.event.schedule == '0 0 * * 0' && '@regression') || '@smoke' }}
      environment: ${{ github.event.inputs.environment || 'stage' }}
      default_environment: 'stage'
    secrets:
      AUTH_EMAIL: ${{ secrets.AUTH_EMAIL }}
      AUTH_PASSWORD: ${{ secrets.AUTH_PASSWORD }}
      AUTH_TOKEN: ${{ secrets.AUTH_TOKEN }}
      LT_USERNAME: ${{ secrets.LT_USERNAME }}
      LT_ACCESS_KEY: ${{ secrets.LT_ACCESS_KEY }}
      SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
      SLACK_CHANNEL: ${{ secrets.SLACK_CHANNEL }}
      SLACK_MENTIONS: ${{ secrets.SLACK_MENTIONS }}
      REPORT_LAB_URL: ${{ secrets.REPORT_LAB_URL }}
