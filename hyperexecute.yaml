---
version: 0.1
globalTimeout: 90
testSuiteTimeout: 30
testSuiteStep: 10

runson: linux
autosplit: true
concurrency: 15

runtime:
  language: node
  version: "20"

env:
  TEST_ENV: ${TEST_ENV}
  TEST_SUITE: ${TEST_SUITE}
  TEST_MODE: "remote"
  LT_PROFILE: ${LT_PROFILE}
  LT_RUN_PROFILE: "regression"
  LT_BUILD_ID: ${LT_BUILD_ID}
  LT_USERNAME: ${LT_USERNAME}
  LT_ACCESS_KEY: ${LT_ACCESS_KEY}
  AUTH_EMAIL: ${AUTH_EMAIL}
  AUTH_PASSWORD: ${AUTH_PASSWORD}
  HE_BUILD_ID: ${HE_BUILD_ID}

cacheKey: '{{ checksum "package-lock.json" }}'
cacheDirectories:
  - node_modules
  - /home/user/.cache/ms-playwright

globalPre: "npm ci && npx playwright install chromium --with-deps"

pre:
  - npx playwright test --project setup

testDiscovery:
  type: raw
  mode: dynamic
  command: node scripts/discover-tests.js --env $TEST_ENV --grep "${TEST_SUITE}"

testRunnerCommand: node scripts/run-tests.js --env $TEST_ENV --mode remote --run-profile regression --grep "${TEST_SUITE}" --retries 2 -- tests/$test

post:
  - echo "Test suite complete"

uploadArtefacts:
  - name: playwright-report
    path:
      - playwright-report/
  - name: allure-results
    path:
      - allure-results/
